{% extends "metadata_form_js.html" %}
{% load i18n %}
{% load static %}
{% load floppyforms %}

{% block hints %}
$('#completeness-hints .mandatory-hint').click(getTab.bind(null, 1));
$('#completeness-hints .advanced-hint').click(getTab.bind(null, 2));
$('#completeness-hints .additional-info-hint').click(getTab.bind(null, 3));
{% endblock hints %}

{% block target %}
    if(target.id === 'category_form' ||
        target.id === 'id_resource-regions' ||
        target.id === 'id_resource-group' ||
        target.id === 'id_access_contraints' ||
        target.id === 'id_use_constraints' ||
        target.id === 'id_resolution' ||
        target.id === 'id_accuracy'
    ) {
        // group selector
        $(target).closest('#basicGroupInfo').toggleClass('has-error', empty);

        // category selector
        $(target).closest('#basicCategoryInfo').toggleClass('has-error', empty);
        // use constraints selector
        $(target).closest('#accessConstraintsInfo').toggleClass('has-error', empty);
        // access constraints selector
        $(target).closest('#useConstraintsInfo').toggleClass('has-error', empty);
        // resolution selector
        $(target).closest('.resolution').toggleClass('has-error', empty);
        // accuracy selector
        $(target).closest('.accuracy').toggleClass('has-error', empty);

        // regions container
        $(target).closest('#regions_multiselect_container').toggleClass('has-error', empty);
        $(target).toggleClass("input-empty", empty);
    }
{% endblock target %}

{% block trigger_onInputChange %}
$('#category_form').change(onInputChange).change();

$('#id_access_contraints').change(onInputChange).change();
$('#id_use_constraints').change(onInputChange).change();
$('#id_resolution').change(onInputChange).change();
$('#id_accuracy').change(onInputChange).change();

$('#id_resource-group').change(onInputChange).change();
document.querySelector('select[name="resource-keywords"]').onchange=onInputChange

$('#id_resource-regions').change(onInputChange).change();
$('#id_resource-temporal_extent_end').on('blur', function() {$(this).change(onInputChange).change();})
$('#id_resource-temporal_extent_start').on('blur', function() {$(this).change(onInputChange).change();})
$('#mandatory').find(":input:not(.value-select):not(.autocomplete)").each(function(){
    if(isMandatoryField(this)) {
        prevNum++;
    }
    $('#category_form').on('rendered.bs.select', function() {
        $('.has-popover').popover({'trigger':'hover'});
    });

    $(this).change(onInputChange).change();

    if(isMandatoryField(this)){
        totalNum++;
    }
});

$('#mdinfo').find(":input:not(.value-select):not(.autocomplete)").each(function(){
    if(isMandatoryField(this)) {
        prevNum++;
    }

    $(this).change(onInputChange).change();

    if(isMandatoryField(this)){
        totalNum++;
    }
});
{% endblock trigger_onInputChange %}
